# 更新日志 (Changelog)

所有重要的更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布] - 2026-02-06

### 🚀 新增功能

- **图像拼接性能模式** - 添加三种性能模式：快速/平衡/高质量
  - 快速模式：ORB检测器，800特征点，0.03秒完成
  - 平衡模式：ORB检测器，1500特征点，0.03秒完成
  - 高质量模式：SIFT检测器，3000特征点，0.46秒完成
- **快速预处理选项** - 可选择启用/禁用快速预处理模式
- **性能监控** - 添加详细的步骤时间记录（特征检测、排序、拼接）
- **新增工具** - 几何变换和图像保存工具
  - 几何变换：支持旋转、缩放等几何操作
  - 图像保存：支持多种格式（PNG/JPG/BMP/TIFF）和自动命名

### 🔧 优化改进

- **图像拼接性能提升17倍**
  - 默认使用ORB替代SIFT（快10-20倍）
  - 优化特征点数量（根据模式800-3000）
  - 减少金字塔层数（从8层降至4-6层）
  - 使用BFMatcher替代FLANN（更稳定）
  - 启用crossCheck=True（一次调用完成双向检查）
  - 限制最大匹配点数量（100个）

- **重影问题修复**
  - 使用sigmoid陡峭权重过渡（替代线性）
  - 减小高斯模糊核（从21x21降至11x11）
  - 在重叠区域中心使用单一图像
  - 添加几何一致性检查

- **预处理优化**
  - 快速模式只进行高斯模糊
  - 跳过CLAHE和形态学运算
  - 添加fast_mode参数控制

### 🐛 错误修复

- **修复图像拼接输入处理问题** (#23)
  - 问题：`process()`方法立即清空`_input_data_list`
  - 症状：即使连接2张图像也提示"至少需要两张图像"
  - 修复：移除`process()`方法中错误的清空逻辑

- **修复输入数据累积问题** (#21)
  - 改进`set_input()`方法的周期检测
  - 添加`_input_count`计数器
  - 超过1秒自动识别为新周期

- **修复工具库空白问题**
  - 问题：工具库面板显示空白，无法显示工具列表
  - 原因：`ToolRegistry`动态加载失败，没有备用方案
  - 修复：恢复硬编码工具列表，确保工具正常显示

- **修复YOLO26-CPU检测器未初始化问题**
  - 问题：加载方案后YOLO26-CPU工具执行时间仅1ms，返回原图
  - 原因：加载已存在工具时未调用`initialize()`方法
  - 修复：在`_add_tool_to_scene()`方法中添加工具初始化逻辑

- **修复新工具参数错误**
  - 问题：几何变换和图像保存工具无法创建
  - 原因：`set_param()`使用了不支持的`min_value`/`max_value`参数
  - 修复：移除不支持的参数

- **修复新工具输入数据获取错误**
  - 问题：几何变换和图像保存工具执行时报错
  - 原因：使用了不存在的方法`get_input_data()`
  - 修复：改为使用正确的`get_input()`方法

- **修复方案加载后算法编辑器空白问题**
  - 问题：打开方案文件后算法编辑器不显示算子
  - 原因：`open_solution()`方法没有重新创建图形项
  - 修复：添加完整的工具加载和连接恢复逻辑

- **修复连接对象访问错误**
  - 问题：打开方案时报错`'ToolConnection' object has no attribute 'get'`
  - 原因：错误地将`ToolConnection`对象当作字典访问
  - 修复：使用正确的属性访问方式`connection.from_tool`和`connection.to_tool`

- **修复热重载回调错误**
  - 问题：热重载时报错`'PropertyDockWidget' object has no attribute 'current_tool'`
  - 原因：访问了不存在的公共属性，实际应为私有属性`_current_tool`
  - 修复：更正属性访问方式

### 📝 文档更新

- 更新AGENTS.md，添加第23、24节错误记录
- 更新性能基准测试报告，添加图像拼接性能数据
- 更新README.md，添加图像拼接优化信息
- 新增CHANGELOG.md文件

### 🔢 性能数据

| 配置 | 优化前 | 优化后 | 提升 |
|------|--------|--------|------|
| ORB Fast | ~0.5s | 0.03s | **17x** |
| ORB Balanced | ~0.5s | 0.03s | **17x** |
| SIFT Quality | ~0.5s | 0.46s | 1.1x |

### 🌐 中文化更新

- 新增参数中文标签：
  - `performance_mode` → "性能模式"
  - `fast_mode` → "快速预处理"
  - 选项标签："快速模式 (速度优先)"/"平衡模式 (推荐)"/"高质量模式 (质量优先)"

---

## [1.0.0] - 2026-01-30

### 🎉 正式发布

- ✅ 完成海康VisionMaster V4.4.0的Python完整重构
- ✅ 通过案例测试
- ✅ 40+算法工具
- ✅ 完整中文化界面
- ✅ 工业级通信支持
- ✅ 方案管理功能
- ✅ 代码生成功能

### 🏗️ 核心功能

- **模块化架构**: 四层架构设计，松耦合高内聚
- **可视化编程**: 拖拽式工具连接，所见即所得
- **内存池**: ImageBufferPool，提升118x分配速度
- **确定性流水线**: DeterministicPipeline，严格顺序处理
- **YOLO26-CPU**: 高性能目标检测
- **图像拼接**: 支持任意顺序图像拼接

### 📚 文档

- AGENTS.md - 开发指南
- ARCHITECTURE.md - 系统架构
- 性能基准测试报告
- 错误处理指南
- 项目综合文档

---

## 版本说明

- **主版本号**: 不兼容的API更改
- **次版本号**: 向下兼容的功能新增
- **修订号**: 向下兼容的问题修复

## 标签说明

- 🚀 Added - 新功能
- 🔧 Changed - 变更
- 🐛 Fixed - 修复
- ⚠️ Deprecated - 弃用
- 🔒 Security - 安全
- 📝 Docs - 文档
